# План админ-панели

План интерфейса админки на основе [ROLES.md](ROLES.md): какие экраны и поля доступны каждой роли. Документ ориентирован на реализацию страницы создания/редактирования недвижимости и разграничение полей по ролям.

---

## 1. Контекст

- Роли и операции: [ROLES.md](ROLES.md), разделы 3–5.
- Объект недвижимости хранится в таблице `objects`; поля соответствуют сущности в коде (entity/DTO).

---

## 2. Поля объекта недвижимости (objects)

Список полей формы «Создание / Редактирование объекта»:

| Поле | Тип | Описание |
|------|-----|----------|
| `title` | string | Название объявления |
| `location` | jsonb | Координаты/адрес (геоданные) |
| `city` | string | Город |
| `district` | string | Район |
| `type` | enum | Тип: apartment, studio, villa, developer_tour |
| `rooms` | number | Количество комнат |
| `area` | number | Площадь (м²) |
| `price_min` | number | Цена от |
| `price_max` | number | Цена до |
| `status` | enum | Статус: for_sale, for_rent, under_construction, planned |
| `partner_id` | uuid | Партнёр (владелец объявления) |
| `developer_id` | uuid | Застройщик |
| `matterport_link` | string | Ссылка на тур Matterport |
| `images` | string[] | Ссылки на фото |
| `description` | text | Описание |
| `published_status` | enum | Публикация: draft, moderation, published, archived |
| `tags` | string[] | Теги |
| `meta` | jsonb | Доп. метаданные |

Служебные (обычно только чтение или скрыты в форме): `id`, `added_date`, `created_at`, `updated_at`.

---

## 3. Страница «Создание / Редактирование недвижимости»: поля по ролям

Условные обозначения:

- **Редактирование** — поле доступно для ввода и сохранения.
- **Только чтение** — поле отображается, но изменить нельзя.
- **Скрыто** — поле не показывается в форме (значение может подставляться на бэкенде).
- **Фиксировано** — значение задаётся системой по текущему пользователю (например, свой `partner_id`), в форме не меняется или показывается как подпись.

---

### 3.1. Partner (Партнёр)

- Работает только со **своими** объектами (`partner_id = свой`).
- На странице создания/редактирования видит только объекты, где `partner_id` совпадает с партнёром текущего пользователя.

| Поле | Создание | Редактирование |
|------|----------|----------------|
| title | Редактирование | Редактирование |
| location | Редактирование | Редактирование |
| city | Редактирование | Редактирование |
| district | Редактирование | Редактирование |
| type | Редактирование | Редактирование |
| rooms | Редактирование | Редактирование |
| area | Редактирование | Редактирование |
| price_min | Редактирование | Редактирование |
| price_max | Редактирование | Редактирование |
| status | Редактирование | Редактирование |
| partner_id | **Фиксировано** (подставляется свой) | **Фиксировано** (только свой) |
| developer_id | Редактирование* | Редактирование* |
| matterport_link | Редактирование | Редактирование |
| images | Редактирование | Редактирование |
| description | Редактирование | Редактирование |
| published_status | Редактирование** | Редактирование** |
| tags | Редактирование | Редактирование |
| meta | Редактирование | Редактирование |

\* Для партнёра объекты обычно без застройщика; при необходимости можно ограничить (только пусто или только свои договоры).
\** По бизнес-логике: партнёр может выставлять draft/moderation; смена на published/archived может требовать техподдержки или админа — уточнить в требованиях.

---

### 3.2. Developer (Застройщик)

- Работает только со **своими** объектами (`developer_id = свой`, тип обычно `developer_tour`).
- Видит только объекты, привязанные к своему застройщику.

| Поле | Создание | Редактирование |
|------|----------|----------------|
| title | Редактирование | Редактирование |
| location | Редактирование | Редактирование |
| city | Редактирование | Редактирование |
| district | Редактирование | Редактирование |
| type | Редактирование (часто фикс. developer_tour) | Редактирование |
| rooms | Редактирование | Редактирование |
| area | Редактирование | Редактирование |
| price_min | Редактирование | Редактирование |
| price_max | Редактирование | Редактирование |
| status | Редактирование | Редактирование |
| partner_id | Редактирование или скрыто* | Редактирование или скрыто* |
| developer_id | **Фиксировано** (свой) | **Фиксировано** (свой) |
| matterport_link | Редактирование | Редактирование |
| images | Редактирование | Редактирование |
| description | Редактирование | Редактирование |
| published_status | Редактирование** | Редактирование** |
| tags | Редактирование | Редактирование |
| meta | Редактирование | Редактирование |

\* Застройщик может не привязывать объявление к партнёру; тогда поле можно скрыть или оставить пустым.
\** Аналогично партнёру: уточнить, может ли застройщик сам переводить в published/archived.

---

### 3.3. Support (Техподдержка)

- Видит **все** объекты; может редактировать и модерировать объявления.
- **Не может:** менять цены и привязку к партнёру (ROLES.md).

| Поле | Создание | Редактирование |
|------|----------|----------------|
| title | Редактирование | Редактирование |
| location | Редактирование | Редактирование |
| city | Редактирование | Редактирование |
| district | Редактирование | Редактирование |
| type | Редактирование | Редактирование |
| rooms | Редактирование | Редактирование |
| area | Редактирование | Редактирование |
| price_min | **Только чтение** | **Только чтение** |
| price_max | **Только чтение** | **Только чтение** |
| status | Редактирование | Редактирование |
| partner_id | **Только чтение** | **Только чтение** |
| developer_id | Редактирование | Редактирование |
| matterport_link | Редактирование | Редактирование |
| images | Редактирование | Редактирование |
| description | Редактирование | Редактирование |
| published_status | Редактирование (модерация) | Редактирование (модерация) |
| tags | Редактирование | Редактирование |
| meta | Редактирование | Редактирование |

При создании объекта Support не задаёт цены и партнёра (или они недоступны); при редактировании эти поля только отображаются.

---

### 3.4. Viewer (Пользователь)

- Только **чтение** всего контента. Создание и редактирование запрещены.

| Действие | Доступ |
|----------|--------|
| Страница создания объекта | **Скрыта** или кнопка «Создать» недоступна |
| Страница редактирования объекта | Все поля в режиме **только чтение** (форма не отправляется на сохранение) или только просмотр карточки без формы |

То есть на «странице» объекта у роли Пользователь (Viewer) все поля только для просмотра, без инпутов на изменение.

---

### 3.5. Admin (Админ)

- Полный доступ к объектам (CUD full). Все поля доступны для создания и редактирования.

| Поле | Создание | Редактирование |
|------|----------|----------------|
| Все поля из раздела 2 | Редактирование | Редактирование |

Ограничений по полям на форме нет (в рамках объектов; системные настройки — отдельно).

---

### 3.6. SuperAdmin (Суперадмин)

- То же, что Admin, для страницы объекта: все поля доступны для создания и редактирования.

| Поле | Создание | Редактирование |
|------|----------|----------------|
| Все поля из раздела 2 | Редактирование | Редактирование |

---

## 4. Сводная матрица: роль × тип доступа к полю (редактирование объекта)

| Поле | Partner | Developer | Support | Viewer | Admin | SuperAdmin |
|------|---------|-----------|-------------------|--------|-------|------------|
| title | ✓ | ✓ | ✓ | только чтение | ✓ | ✓ |
| location | ✓ | ✓ | ✓ | только чтение | ✓ | ✓ |
| city | ✓ | ✓ | ✓ | только чтение | ✓ | ✓ |
| district | ✓ | ✓ | ✓ | только чтение | ✓ | ✓ |
| type | ✓ | ✓ | ✓ | только чтение | ✓ | ✓ |
| rooms | ✓ | ✓ | ✓ | только чтение | ✓ | ✓ |
| area | ✓ | ✓ | ✓ | только чтение | ✓ | ✓ |
| price_min | ✓ | ✓ | **только чтение** | только чтение | ✓ | ✓ |
| price_max | ✓ | ✓ | **только чтение** | только чтение | ✓ | ✓ |
| status | ✓ | ✓ | ✓ | только чтение | ✓ | ✓ |
| partner_id | фиксировано (свой) | скрыто/пусто* | **только чтение** | только чтение | ✓ | ✓ |
| developer_id | ✓* | фиксировано (свой) | ✓ | только чтение | ✓ | ✓ |
| matterport_link | ✓ | ✓ | ✓ | только чтение | ✓ | ✓ |
| images | ✓ | ✓ | ✓ | только чтение | ✓ | ✓ |
| description | ✓ | ✓ | ✓ | только чтение | ✓ | ✓ |
| published_status | ✓** | ✓** | ✓ | только чтение | ✓ | ✓ |
| tags | ✓ | ✓ | ✓ | только чтение | ✓ | ✓ |
| meta | ✓ | ✓ | ✓ | только чтение | ✓ | ✓ |

\* См. примечания в подразделах 3.1 и 3.2.
\** Ограничения по смене published_status для Partner/Developer — по продукту.

---

## 5. Рекомендации для реализации

1. **Бэкенд:** проверять права по роли при каждом создании/обновлении объекта (в т.ч. запрет изменения `price_min`, `price_max`, `partner_id` для Support; подстановка своего `partner_id`/`developer_id` для Partner/Developer).
2. **Фронт:** рендерить форму на основе роли (disabled/readonly для полей «только чтение», скрывать или фиксировать `partner_id`/`developer_id` где нужно).
3. **Единый компонент формы:** конфигурация «роль → права на поля» вынести в один модуль/конфиг (например, объект «fieldPermissions» по полям и ролям), чтобы не дублировать логику.
4. **Пользователь (Viewer):** не показывать кнопки «Создать» / «Сохранить» или показывать страницу объекта только в режиме просмотра (без отправки формы).

Дальше можно добавить в этот же документ разделы по другим экранам админки (партнёры, застройщики, пользователи, ссылки, аналитика) по тому же принципу: экран → поля/действия → матрица по ролям.
